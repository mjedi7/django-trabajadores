{% extends 'planilla/menu.html' %}
{% block title %}Organigrama{% endblock %}
{% block content %}

<div class="container mt-4">
  <h3 class="text-center mb-3">Organigrama por Plantel</h3>

  <!-- Selector de plantel -->
  <form method="get" class="mb-3">
    <div class="input-group">
      <select name="adscripcion" class="form-select" required>
        <option value="">Seleccione un Plantel</option>
        {% for p in planteles %}
          <option value="{{ p }}" {% if p == request.GET.adscripcion %}selected{% endif %}>{{ p }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="btn btn-primary">Mostrar</button>
    </div>
  </form>

  <!-- Contenedor del organigrama -->
  {% if tree_data %}
    <div id="organigrama" style="width: 100%; height: 600px;"></div>
  {% endif %}
</div>

<!-- ECharts -->
<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
{% if tree_data %}
<script>
var chart = echarts.init(document.getElementById('organigrama'));
var option = {
    tooltip: { trigger: 'item', triggerOn: 'mousemove' },
    series: [{
        type: 'tree',
        data: [{{ tree_data|safe }}],
        top: '5%',
        left: '10%',
        bottom: '5%',
        right: '20%',
        symbolSize: 15,
        label: { position: 'left', verticalAlign: 'middle', align: 'right', fontSize: 12 },
        leaves: { label: { position: 'right', verticalAlign: 'middle', align: 'left' } },
        expandAndCollapse: true,
        initialTreeDepth: -1,
        animationDuration: 550,
        animationDurationUpdate: 750
    }]
};
chart.setOption(option);
window.addEventListener('resize', () => { chart.resize(); });
</script>
{% endif %}
{% endblock %}
